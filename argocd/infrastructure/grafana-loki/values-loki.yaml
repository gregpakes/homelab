# Loki (grafana/loki) - Monolithic (single binary) with MinIO (S3) object storage
fullnameOverride: loki

deploymentMode: SingleBinary

singleBinary:
  replicas: 2
  persistence:
    enabled: true
    storageClass: longhorn
    size: 10Gi

# Ensure SimpleScalable components stay disabled in SingleBinary mode
write:
  replicas: 0
read:
  replicas: 0
backend:
  replicas: 0

global:
  extraArgs:
    - -config.expand-env=true
  extraEnvFrom:
    - secretRef:
        name: loki-s3-credentials

loki:
  auth_enabled: false
  commonConfig:
    replication_factor: 2
  storage:
    type: s3
    bucketNames:
      chunks: loki-chunks
      ruler: loki-ruler
    s3:
      endpoint: minio.minio.svc.cluster.local:9000
      accessKeyId: ${LOKI_S3_ACCESS_KEY_ID}
      secretAccessKey: ${LOKI_S3_SECRET_ACCESS_KEY}
      s3ForcePathStyle: true
      insecure: true
  schemaConfig:
    configs:
      - from: 2024-04-01
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: index_
          period: 24h

monitoring:
  serviceMonitor:
    enabled: true
